-- Part 15: Equipment Usage (Links equipment to activities)
-- First, we need equipment with known IDs, then link to TCX files

-- ============================================
-- EQUIPMENT WITH EXPLICIT IDs (replaces/updates existing)
-- ============================================

-- Delete existing equipment to avoid conflicts (if running fresh)
DELETE FROM equipment_usage WHERE equipment_id IN (
  SELECT id FROM equipment WHERE athlete_id = '00000000-0000-0000-0000-000000000001'
);
DELETE FROM equipment WHERE athlete_id = '00000000-0000-0000-0000-000000000001';

-- Insert equipment with explicit IDs
INSERT INTO equipment (id, athlete_id, equipment_type, name, brand, model, purchase_date, purchase_price, currency, bike_type, frame_size, frame_material, groupset, wheelset, weight_kg, service_interval_km, last_service_date, last_service_km, total_km, total_hours, status, condition, notes, photo_url) VALUES

-- Primary Race Bike
('20000000-0000-0000-0000-000000000001',
'00000000-0000-0000-0000-000000000001',
'bike',
'Race Bike',
'Specialized',
'Tarmac SL7 Expert',
'2023-03-15',
5500.00,
'EUR',
'road',
'56',
'carbon',
'Shimano Ultegra Di2',
'Roval Rapide CLX',
7.2,
5000,
CURRENT_DATE - 45,
12500,
15800,
520,
'active',
'good',
'Main race bike. Di2 battery replaced Jan 2024. New chain at 3000km intervals.',
NULL),

-- Gravel/Winter Bike
('20000000-0000-0000-0000-000000000002',
'00000000-0000-0000-0000-000000000001',
'bike',
'Gravel Bike',
'Canyon',
'Grail CF SL 8',
'2024-06-20',
3200.00,
'EUR',
'gravel',
'56',
'carbon',
'Shimano GRX 810',
'DT Swiss GRC 1400',
8.1,
3000,
CURRENT_DATE - 90,
2800,
4200,
180,
'active',
'excellent',
'Winter and gravel riding. 38mm tires for mixed terrain.',
NULL),

-- Smart Trainer
('20000000-0000-0000-0000-000000000003',
'00000000-0000-0000-0000-000000000001',
'trainer',
'Smart Trainer',
'Wahoo',
'KICKR V6',
'2024-01-10',
1200.00,
'EUR',
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
320,
'active',
'excellent',
'Indoor setup. Calibrated monthly. Zwift and TrainerRoad compatible.',
NULL),

-- Power Meter (on race bike)
('20000000-0000-0000-0000-000000000004',
'00000000-0000-0000-0000-000000000001',
'power_meter',
'Power Meter',
'Garmin',
'Rally XC200',
'2023-03-15',
850.00,
'EUR',
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
520,
'active',
'good',
'Dual-sided pedal power meter. Batteries changed every 200 hours.',
NULL),

-- Aero Helmet
('20000000-0000-0000-0000-000000000005',
'00000000-0000-0000-0000-000000000001',
'helmet',
'Aero Helmet',
'Specialized',
'S-Works Evade 3',
'2024-02-28',
280.00,
'EUR',
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
180,
'active',
'excellent',
'Race helmet. MIPS equipped. Size M.',
NULL),

-- Road Shoes
('20000000-0000-0000-0000-000000000006',
'00000000-0000-0000-0000-000000000001',
'shoes',
'Road Shoes',
'Sidi',
'Shot 2',
'2023-08-10',
350.00,
'EUR',
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
400,
'active',
'good',
'Main road shoes. Size 44. Cleats replaced every 5000km.',
NULL),

-- Heart Rate Monitor
('20000000-0000-0000-0000-000000000007',
'00000000-0000-0000-0000-000000000001',
'accessories',
'Heart Rate Strap',
'Garmin',
'HRM-Pro Plus',
'2024-01-15',
120.00,
'EUR',
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
450,
'active',
'good',
'Dual transmission ANT+/Bluetooth. Running dynamics capable.',
NULL),

-- Bike Computer
('20000000-0000-0000-0000-000000000008',
'00000000-0000-0000-0000-000000000001',
'accessories',
'Bike Computer',
'Garmin',
'Edge 840 Solar',
'2023-06-01',
550.00,
'EUR',
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
520,
'active',
'excellent',
'Primary head unit. Maps, navigation, training metrics.',
NULL);

-- ============================================
-- EQUIPMENT USAGE (Links to TCX files from seed-part-11)
-- ============================================

INSERT INTO equipment_usage (equipment_id, tcx_file_id, date, distance_km, duration_hours, elevation_m) VALUES

-- Race bike usage (outdoor rides)
('20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', CURRENT_DATE - 29, 42.0, 1.5, 320),
('20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000002', CURRENT_DATE - 27, 85.0, 2.0, 650),
('20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000003', CURRENT_DATE - 26, 32.0, 1.17, 180),
('20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000004', CURRENT_DATE - 25, 28.0, 1.0, 150),
('20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000005', CURRENT_DATE - 23, 115.0, 3.0, 1200),
('20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000006', CURRENT_DATE - 22, 40.0, 1.5, 280),
('20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000007', CURRENT_DATE - 20, 48.0, 1.75, 350),
('20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000008', CURRENT_DATE - 19, 30.0, 1.17, 160),
('20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000009', CURRENT_DATE - 18, 42.0, 1.5, 300),
('20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000010', CURRENT_DATE - 16, 145.0, 4.0, 2200),
('20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000011', CURRENT_DATE - 15, 25.0, 1.0, 120),
('20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000012', CURRENT_DATE - 13, 45.0, 1.67, 340),
('20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000013', CURRENT_DATE - 12, 35.0, 1.25, 220),
('20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000015', CURRENT_DATE - 9, 95.0, 2.5, 1500),
('20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000016', CURRENT_DATE - 8, 30.0, 1.17, 150),
('20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000017', CURRENT_DATE - 6, 46.0, 1.67, 380),
('20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000018', CURRENT_DATE - 5, 42.0, 1.5, 280),
('20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000019', CURRENT_DATE - 4, 34.0, 1.25, 200),
('20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000020', CURRENT_DATE - 2, 50.0, 1.75, 420),
('20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000021', CURRENT_DATE - 1, 40.0, 1.42, 260),

-- Race bike also used for past races
('20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000023', CURRENT_DATE - 120, 140.0, 4.88, 2500),
('20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000024', CURRENT_DATE - 150, 165.0, 5.0, 2800),

-- Smart trainer usage (indoor rides)
('20000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-000000000014', CURRENT_DATE - 11, 38.0, 1.5, 450),
('20000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-000000000022', CURRENT_DATE - 45, 32.0, 1.0, 180),

-- Power meter usage (same as race bike outdoor + indoor)
('20000000-0000-0000-0000-000000000004', '10000000-0000-0000-0000-000000000001', CURRENT_DATE - 29, 42.0, 1.5, 320),
('20000000-0000-0000-0000-000000000004', '10000000-0000-0000-0000-000000000002', CURRENT_DATE - 27, 85.0, 2.0, 650),
('20000000-0000-0000-0000-000000000004', '10000000-0000-0000-0000-000000000005', CURRENT_DATE - 23, 115.0, 3.0, 1200),
('20000000-0000-0000-0000-000000000004', '10000000-0000-0000-0000-000000000007', CURRENT_DATE - 20, 48.0, 1.75, 350),
('20000000-0000-0000-0000-000000000004', '10000000-0000-0000-0000-000000000010', CURRENT_DATE - 16, 145.0, 4.0, 2200),
('20000000-0000-0000-0000-000000000004', '10000000-0000-0000-0000-000000000012', CURRENT_DATE - 13, 45.0, 1.67, 340),
('20000000-0000-0000-0000-000000000004', '10000000-0000-0000-0000-000000000015', CURRENT_DATE - 9, 95.0, 2.5, 1500),
('20000000-0000-0000-0000-000000000004', '10000000-0000-0000-0000-000000000017', CURRENT_DATE - 6, 46.0, 1.67, 380),
('20000000-0000-0000-0000-000000000004', '10000000-0000-0000-0000-000000000020', CURRENT_DATE - 2, 50.0, 1.75, 420),

-- Heart rate strap usage (all rides)
('20000000-0000-0000-0000-000000000007', '10000000-0000-0000-0000-000000000001', CURRENT_DATE - 29, 42.0, 1.5, 320),
('20000000-0000-0000-0000-000000000007', '10000000-0000-0000-0000-000000000002', CURRENT_DATE - 27, 85.0, 2.0, 650),
('20000000-0000-0000-0000-000000000007', '10000000-0000-0000-0000-000000000005', CURRENT_DATE - 23, 115.0, 3.0, 1200),
('20000000-0000-0000-0000-000000000007', '10000000-0000-0000-0000-000000000010', CURRENT_DATE - 16, 145.0, 4.0, 2200),
('20000000-0000-0000-0000-000000000007', '10000000-0000-0000-0000-000000000014', CURRENT_DATE - 11, 38.0, 1.5, 450),
('20000000-0000-0000-0000-000000000007', '10000000-0000-0000-0000-000000000015', CURRENT_DATE - 9, 95.0, 2.5, 1500),
('20000000-0000-0000-0000-000000000007', '10000000-0000-0000-0000-000000000020', CURRENT_DATE - 2, 50.0, 1.75, 420),
('20000000-0000-0000-0000-000000000007', '10000000-0000-0000-0000-000000000022', CURRENT_DATE - 45, 32.0, 1.0, 180),
('20000000-0000-0000-0000-000000000007', '10000000-0000-0000-0000-000000000023', CURRENT_DATE - 120, 140.0, 4.88, 2500),

-- Bike computer usage (all outdoor rides)
('20000000-0000-0000-0000-000000000008', '10000000-0000-0000-0000-000000000001', CURRENT_DATE - 29, 42.0, 1.5, 320),
('20000000-0000-0000-0000-000000000008', '10000000-0000-0000-0000-000000000002', CURRENT_DATE - 27, 85.0, 2.0, 650),
('20000000-0000-0000-0000-000000000008', '10000000-0000-0000-0000-000000000005', CURRENT_DATE - 23, 115.0, 3.0, 1200),
('20000000-0000-0000-0000-000000000008', '10000000-0000-0000-0000-000000000010', CURRENT_DATE - 16, 145.0, 4.0, 2200),
('20000000-0000-0000-0000-000000000008', '10000000-0000-0000-0000-000000000015', CURRENT_DATE - 9, 95.0, 2.5, 1500),
('20000000-0000-0000-0000-000000000008', '10000000-0000-0000-0000-000000000020', CURRENT_DATE - 2, 50.0, 1.75, 420),
('20000000-0000-0000-0000-000000000008', '10000000-0000-0000-0000-000000000023', CURRENT_DATE - 120, 140.0, 4.88, 2500),
('20000000-0000-0000-0000-000000000008', '10000000-0000-0000-0000-000000000024', CURRENT_DATE - 150, 165.0, 5.0, 2800);

-- Update equipment totals based on usage
UPDATE equipment SET
  total_km = (SELECT COALESCE(SUM(distance_km), 0) FROM equipment_usage WHERE equipment_id = equipment.id),
  total_hours = (SELECT COALESCE(SUM(duration_hours), 0) FROM equipment_usage WHERE equipment_id = equipment.id)
WHERE athlete_id = '00000000-0000-0000-0000-000000000001'
  AND equipment_type IN ('bike', 'power_meter', 'accessories', 'trainer');
