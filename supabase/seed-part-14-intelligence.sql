-- Part 14: Intelligence Layer (AI-generated insights + Training Focus)
-- Lucy's analysis and recommendations for demo athlete

-- ============================================
-- ATHLETE INSIGHTS
-- ============================================

INSERT INTO athlete_insights (athlete_id, insight_type, category, title, description, confidence, evidence, actionable, action_suggested, valid_from, valid_until) VALUES

-- STRENGTHS
('00000000-0000-0000-0000-000000000001',
'strength',
'training',
'Excellent Threshold Power',
'Your FTP of 285W (3.93 W/kg) places you in the 82nd percentile for your age and competitive level. This is your primary strength and a solid foundation for racing.',
92,
'{"ftp_watts": 285, "ftp_w_per_kg": 3.93, "percentile": 82, "comparison_group": "amateur_elite_males_30-40", "data_points": 12, "trend": "improving"}',
false,
NULL,
CURRENT_DATE - 30,
CURRENT_DATE + 60),

('00000000-0000-0000-0000-000000000001',
'strength',
'training',
'Strong VO2max Capacity',
'Your 5-minute power of 320W (4.41 W/kg) indicates excellent aerobic capacity. This serves you well on climbs of 4-8 minutes.',
88,
'{"5min_power": 320, "5min_w_per_kg": 4.41, "vo2max_percentile": 78, "recent_tests": 3}',
true,
'Continue VO2max intervals 1-2x per week during build phase. Target 5x4min at 105-115% FTP.',
CURRENT_DATE - 14,
CURRENT_DATE + 45),

('00000000-0000-0000-0000-000000000001',
'strength',
'recovery',
'Consistent Sleep Patterns',
'Your average sleep duration of 7.4 hours with 87% efficiency is excellent for an amateur athlete. This supports recovery and adaptation.',
85,
'{"avg_sleep_hours": 7.4, "avg_efficiency": 87, "nights_below_7h": 4, "days_analyzed": 30}',
false,
NULL,
CURRENT_DATE - 7,
CURRENT_DATE + 30),

('00000000-0000-0000-0000-000000000001',
'strength',
'nutrition',
'Good Protein Intake',
'Average daily protein of 142g (1.96g/kg) exceeds recommendations for endurance athletes. This supports muscle repair and adaptation.',
82,
'{"avg_protein_g": 142, "protein_per_kg": 1.96, "target": 1.6, "days_tracked": 30}',
false,
NULL,
CURRENT_DATE - 7,
CURRENT_DATE + 30),

-- WEAKNESSES
('00000000-0000-0000-0000-000000000001',
'weakness',
'training',
'Neuromuscular Power Gap',
'Your 5-second power of 1020W (14.07 W/kg) is at the 65th percentile - below your threshold percentile. This limits sprint finishes and short attacks.',
78,
'{"5s_power": 1020, "5s_w_per_kg": 14.07, "percentile": 65, "gap_to_threshold": -17, "comparison": "threshold_percentile_82"}',
true,
'Add 2x weekly sprint work: 6-8 x 10-15 second max efforts with full recovery. Consider gym-based explosive training.',
CURRENT_DATE - 14,
CURRENT_DATE + 60),

('00000000-0000-0000-0000-000000000001',
'weakness',
'training',
'Durability Needs Improvement',
'Your power retention after 2+ hours drops to 88.5% of fresh values. For gran fondos, targeting 92-95% would improve late-race performance.',
75,
'{"retention_pct": 88.5, "target_retention": 93, "fatigued_cp": 244, "fresh_cp": 275, "rides_analyzed": 8}',
true,
'Incorporate more long rides with intensity in the final hour. Progressive endurance rides building to 4-5 hours with tempo/threshold blocks in hours 3-4.',
CURRENT_DATE - 21,
CURRENT_DATE + 90),

('00000000-0000-0000-0000-000000000001',
'weakness',
'recovery',
'HRV Variability on High-Stress Days',
'Your HRV drops 15-20% below baseline following high work-stress days, more than typical training fatigue. Work stress may be impacting recovery.',
72,
'{"hrv_drop_work_stress": 18, "hrv_drop_training": 8, "high_stress_days_30d": 6, "correlation": 0.68}',
true,
'On high work-stress days, consider lighter training or complete rest. Recovery is compromised even without physical load.',
CURRENT_DATE - 14,
CURRENT_DATE + 45),

-- PATTERNS
('00000000-0000-0000-0000-000000000001',
'pattern',
'training',
'Weekend Warrior Tendency',
'65% of your weekly TSS comes from Saturday/Sunday rides. This creates recovery challenges early in the week.',
85,
'{"weekend_tss_pct": 65, "monday_readiness_avg": 68, "optimal_distribution": "40-45%", "weeks_analyzed": 12}',
true,
'Try to distribute 1 quality session mid-week. Tuesday or Thursday threshold work can reduce weekend load while maintaining fitness.',
CURRENT_DATE - 30,
CURRENT_DATE + 60),

('00000000-0000-0000-0000-000000000001',
'pattern',
'sleep',
'Friday Night Sleep Disruption',
'Friday nights show 12% lower sleep scores than other nights, likely social activities. This impacts Saturday training quality.',
70,
'{"friday_avg_score": 71, "other_nights_avg": 78, "friday_sleep_hours": 6.8, "other_nights": 7.5, "weeks_analyzed": 8}',
true,
'If Saturday is a key training day, prioritize Friday sleep or shift key sessions to Sunday.',
CURRENT_DATE - 21,
CURRENT_DATE + 45),

('00000000-0000-0000-0000-000000000001',
'pattern',
'nutrition',
'Under-fueling During Long Rides',
'On rides over 3 hours, your during-workout carb intake averages 45g/hour. Research suggests 60-90g/hour for optimal performance.',
80,
'{"current_carb_per_hour": 45, "recommended_min": 60, "recommended_max": 90, "long_rides_analyzed": 6}',
true,
'Increase during-ride fueling to 60g carbs/hour minimum. Practice gut training with higher intake during training rides.',
CURRENT_DATE - 14,
CURRENT_DATE + 60),

('00000000-0000-0000-0000-000000000001',
'pattern',
'training',
'Strong Response to Sweet Spot Training',
'Your CTL increases 15% faster during sweet spot blocks compared to traditional base training. Your physiology responds well to this intensity.',
78,
'{"ctl_growth_sweetspot": 4.2, "ctl_growth_base": 3.1, "blocks_compared": 4, "adaptation_rate": "above_average"}',
false,
NULL,
CURRENT_DATE - 45,
CURRENT_DATE + 90),

-- RECOMMENDATIONS
('00000000-0000-0000-0000-000000000001',
'recommendation',
'training',
'Pre-Race Taper Strategy',
'Based on your response to training load changes, a 10-14 day taper with 40-50% volume reduction optimizes your form for A races.',
82,
'{"optimal_taper_days": 12, "volume_reduction": 45, "intensity_maintenance": 90, "historical_races": 3, "best_tsb_range": "8-15"}',
true,
'For Milano-Sanremo: Begin taper 12 days out. Maintain 2 short, sharp sessions per week. Target race-day TSB of +10 to +15.',
CURRENT_DATE - 7,
CURRENT_DATE + 100),

('00000000-0000-0000-0000-000000000001',
'recommendation',
'nutrition',
'Race Week Carb Loading',
'Your body weight and training data suggest a carb loading target of 8-10g/kg for 2-3 days pre-race.',
75,
'{"weight_kg": 72.5, "daily_carb_target_g": "580-725", "glycogen_optimization": true, "based_on": "weight_and_intensity"}',
true,
'3 days before A races: Increase carbs to 8g/kg (580g), reduce fiber and fat. Focus on familiar, easily digestible sources.',
CURRENT_DATE - 7,
CURRENT_DATE + 100),

('00000000-0000-0000-0000-000000000001',
'recommendation',
'recovery',
'Optimize Post-Ride Recovery Window',
'Your adaptation improves when protein intake occurs within 30 minutes post-ride. Current average is 45 minutes.',
70,
'{"current_avg_minutes": 45, "optimal_window": 30, "protein_timing_correlation": 0.58, "adaptation_improvement": "8-12%"}',
true,
'Prepare recovery shake before rides. Target 25-30g protein within 30 minutes of finishing.',
CURRENT_DATE - 14,
CURRENT_DATE + 60),

('00000000-0000-0000-0000-000000000001',
'recommendation',
'training',
'Heat Acclimation for Summer Races',
'Summer Gran Fondo may have temperatures above 30Â°C. Beginning heat acclimation 2 weeks prior improves performance.',
72,
'{"expected_race_temp": 32, "recommended_protocol": "heat_chamber_or_overdress", "sessions_needed": 8, "time_before_event": 14}',
true,
'Starting 14 days before summer race: Add 4-5 indoor sessions with extra layers, targeting core temp increase. Hydration protocol adjustments needed.',
CURRENT_DATE - 7,
CURRENT_DATE + 160);

-- ============================================
-- TRAINING FOCUS
-- ============================================

INSERT INTO training_focus (athlete_id, start_date, end_date, focus_area, priority, rationale, target_metrics, progress_notes, achieved) VALUES

-- Current focus areas
('00000000-0000-0000-0000-000000000001',
CURRENT_DATE - 30,
CURRENT_DATE + 60,
'ftp',
1,
'Primary goal: Increase FTP to 295W (4.07 W/kg) for Milano-Sanremo. Current: 285W. Need 3.5% improvement.',
'{"ftp_target_watts": 295, "ftp_target_w_per_kg": 4.07, "weekly_tss_target": 450, "sweet_spot_hours": 3}',
'Week 1-2: Responded well to increased sweet spot volume. Week 3: Minor fatigue, adjusted with recovery week. Week 4: Back on track, FTP trending up.',
false),

('00000000-0000-0000-0000-000000000001',
CURRENT_DATE - 30,
CURRENT_DATE + 60,
'endurance',
2,
'Build durability for 6+ hour gran fondo. Need to improve power retention in final 2 hours of long events.',
'{"long_ride_hours_weekly": 4, "target_retention_pct": 92, "progressive_ride_length": "5hrs"}',
'Building long ride duration progressively. Recent 4-hour ride showed good form. Next target: 5-hour ride with tempo finish.',
false),

('00000000-0000-0000-0000-000000000001',
CURRENT_DATE - 14,
CURRENT_DATE + 45,
'vo2max',
3,
'Maintain and slightly improve VO2max to handle race surges and climbs. Not primary focus but important for race scenarios.',
'{"5min_target": 330, "weekly_vo2_sessions": 1, "interval_format": "5x4min"}',
'Maintaining 1 VO2max session per week. Last test showed 320W, on track.',
false),

('00000000-0000-0000-0000-000000000001',
CURRENT_DATE - 7,
CURRENT_DATE + 30,
'weight_loss',
4,
'Lose 0.5kg to improve W/kg without compromising power. Current: 72.5kg, Target: 72kg race weight.',
'{"current_weight": 72.5, "target_weight": 72.0, "weekly_loss_target": 0.1, "method": "small_deficit_non_training_days"}',
'Starting controlled deficit on rest days. Maintaining full fueling on training days. Down 0.2kg in week 1.',
false),

-- Past completed focuses
('00000000-0000-0000-0000-000000000001',
CURRENT_DATE - 120,
CURRENT_DATE - 60,
'ftp',
1,
'Off-season FTP development. Target: Raise FTP from 275W to 285W through structured base and build.',
'{"ftp_start": 275, "ftp_target": 285, "achieved": 285}',
'Completed successfully! FTP test on day 45 confirmed 285W. 3.6% improvement over 8 weeks.',
true),

('00000000-0000-0000-0000-000000000001',
CURRENT_DATE - 180,
CURRENT_DATE - 120,
'endurance',
1,
'Summer base building. Accumulate aerobic volume for autumn racing season.',
'{"weekly_hours_target": 12, "monthly_distance_km": 1200, "zone2_percentage": 75}',
'Great base block. Averaged 11.5 hours/week. Built strong aerobic foundation for race season.',
true),

('00000000-0000-0000-0000-000000000001',
CURRENT_DATE - 240,
CURRENT_DATE - 200,
'recovery',
1,
'Post-illness recovery focus. Gradual return to training after cold/flu.',
'{"return_to_full_training_weeks": 3, "max_hr_limitation": 150, "no_intervals": true}',
'Recovered well. Patience paid off - no setbacks. Full training resumed after 3 weeks.',
true),

('00000000-0000-0000-0000-000000000001',
CURRENT_DATE - 300,
CURRENT_DATE - 240,
'sprint',
2,
'Winter sprint work to address neuromuscular weakness identified in previous season.',
'{"sprint_sessions_weekly": 2, "5s_target": 1050, "gym_sessions": 1}',
'Partial success. 5s power improved from 980W to 1020W (4%). Did not reach 1050W target. Will revisit next off-season.',
false);
